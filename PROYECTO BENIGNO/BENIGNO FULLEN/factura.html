<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Factura | Benigno</title>
  <link rel="stylesheet" href="static/css/factura.css">
</head>
<body>



  <div class="background-benigno"></div>
  <div class="background-overlay"></div>


<div class="factura-container" id="factura">
  <p style="color:#fff; text-align:center;">Cargando factura...</p>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");
const cont = document.getElementById("factura");

if (!id) {
  cont.innerHTML = "<p>Factura no encontrada</p>";
} else {
  fetch(`obtener_factura.php?id=${id}`)
    .then(res => res.json())
    .then(data => {

      if (data.error) {
        cont.innerHTML = `<p>${data.error}</p>`;
        return;
      }

      cont.innerHTML = `
        <div class="tarjeta factura-box">
          <h2>Factura Digital</h2>

            <div class="mensaje-confirmacion">
  <span class="icono-check">✔</span>
  <span>
    Recibimos tu pedido correctamente.  
    Nuestro equipo estará pendiente para prepararlo lo antes posible.
  </span>
</div>



          <p><strong>Pedido #:</strong> ${data.id}</p>
          <p><strong>Cliente:</strong> ${data.nombre_cliente}</p>
          <p><strong>Teléfono:</strong> ${data.telefono}</p>
          <p><strong>Método de pago:</strong> ${data.metodo_pago}</p>
          <p><strong>Tipo de entrega:</strong> ${data.tipo_entrega}</p>

          ${data.direccion ? `<p><strong>Dirección:</strong> ${data.direccion}</p>` : ""}

          <hr>

          <h3 class="titulo-detalle">Detalle del pedido</h3>

          <pre class="detalle-pedido">
${data.descripcion?.trim() || 'Sin detalle de productos'}
</pre>



          <hr>

          <p class="total-factura">
            Total pagado:
            <span>$${Number(data.total).toLocaleString()}</span>
          </p>

          <div class="botones-factura">
            <button onclick="window.print()" class="btn-confirmar">Imprimir / Guardar</button>
            <button onclick="window.location.href='index.html'" class="btn-cancelar">Volver al inicio</button>
          </div>
        </div>
      `;
    })
    .catch(err => {
      console.error(err);
      cont.innerHTML = "<p>Error al cargar la factura</p>";
    });
}


  fetch(`obtener_detalle_pedido.php?id=${id}`)
  .then(res => res.json())
  .then(productos => {
    const contenedor = document.getElementById("detalle-productos");

    if (!productos.length) {
      contenedor.innerHTML = "<p>Sin detalle de productos</p>";
      return;
    }

    let html = `
      <table class="tabla-detalle">
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Subtotal</th>
        </tr>
    `;

    productos.forEach(p => {
      html += `
        <tr>
          <td>${p.producto}</td>
          <td>${p.cantidad}</td>
          <td>$${Number(p.precio).toLocaleString()}</td>
          <td>$${Number(p.precio * p.cantidad).toLocaleString()}</td>
        </tr>
      `;
    });

    html += "</table>";
    contenedor.innerHTML = html;
  });















</script>



</body>
</html>
